<!doctype html>
<link rel="stylesheet" type="text/css" href="style/main.css">
<html>
	<head>
		<span style="border: 2px solid black">
			<a href="../">Home</a>
		</span>
		<section>
		<h1>Title</h1>
		</section>
		
	</head>
	<body>
		<section id="helloWorld-container">
			<span id="helloText">Hello, World!</span>
		</section>
		<section>
			<input type="button" value="Change Text" onclick="changeText('http://api.icndb.com/jokes/random', 'GET', '')" />
			<input type="button" value="Load List" onclick="loadList('https://api.github.com/search/repositories', 'GET', 'q=Javascript')" /><br>
			<input type="text" placeholder="ingrese un repositorio" onkeyup="buscarRepositorio();" id="filter">
		</section>
		<section>
			<ul id="fullNameList" style="list-style-type:none">
			</ul>
		</section>
	</body>
</html>

<script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function(event)
	{
    	console.log("Fade in effect...");
    	document.getElementById("helloWorld-container").classList.add("fadeInSection");
  	});


  	function changeText(url, method, params){

  		callService(url, method, params).then(
			function(val) {
				document.getElementById("helloText").innerHTML = JSON.parse(val).value.joke
				document.getElementById("helloWorld-container").classList.remove("section-error");
			},
			function(err) {
				document.getElementById("helloText").innerHTML = err.type;
  				document.getElementById("helloWorld-container").classList.add("section-error");
  			});
  		
   	}



   	function loadList(url, method, params){

  		callService(url, method, params).then(
			function(val) {
				var elem = JSON.parse(val);
				console.log(elem);

				var ul = document.getElementById("fullNameList");
				var items = elem.items;
				for(i = 0 ;i < elem.items.length ; i++) {
					var li = document.createElement("li");
  					li.appendChild(document.createTextNode(items[i].full_name.split("/")[0]));
  					li.setAttribute("id", items[i].id); // added line
  					ul.appendChild(li);
				};
			},
			function(err) {
				console.log("Error loading list");
  			});
  		
   	}

   	function callService(url, method, params){

		var p = new Promise(function(resolve,reject) {

			var xhttp = new XMLHttpRequest();

    		xhttp.open(method, url+"?"+params, true);

			xhttp.onload = function () {
          		if (this.status == 200 && this.response.length > 0) {
          			resolve(this.response)
	          } else {
	           		reject({type:'Error'});
	          }
        	};
        	
        	xhttp.onerror = function () {
          		reject({type:'Error'});
    		};

    		xhttp.send(null);
		})
		

		return p;
	}

	function buscarRepositorio(){
		var texto = document.getElementById('filter').value;

		var listItems = document.getElementsByTagName('li');
		for(i = 0; i < listItems.length; i++) {
			if(listItems[i].innerHTML.includes(texto)) 
				listItems[i].classList.remove('listaOculta');
			else
				listItems[i].classList.add('listaOculta');
			}
		}
	



</script>